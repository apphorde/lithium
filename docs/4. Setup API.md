# The Component Setup API

## computed(fn)

A reference that is always computed on state checks. Takes a function and returns a ref that is auto-updated when scope checks are executed.

## ref(val) and shallowRef(val)

`ref` creates a reference to a value that can change at runtime. Changes to any `ref` value inside a component scope trigger an update.
If the ref contains an object, any property change in that object also triggers an update (deeply checked).
An initial value can be given to it.

`shallowRef` is the mostly the same, with the difference that it will not deeply watch object changes in the ref value.

## defineEvent(name)

Defines a function that emits a custom event called by `name`. Use this function to emit a specific event in the template.

## defineEvents(names)

A convenience method to define multiple events at once. The returned function emits events by name and accepts a second argument:

```ts
const emit = defineEvents(['one', 'two']);
emit('one', 1);
```

## defineProp(name, definitions)

Define an input property for a custom element.
The component scope is checked every time this property changes.

## defineProps(names) / defineProps(table)

Define multiple props in one shot

## defineQuery(selector)

Return a dynamic object that can either grab a list of child nodes (`.many`) or one child node (`.one`)

## inject(target) and provide(target, value)

An injection mechanism using DOM events. Use `provide(target, value)` to provide a value to child nodes of a custom element.

In a child node, use `inject(target)` to retrieve a value from parent nodes. The first parent to provide a value in the DOM tree wins.

## loadCss(url)

Loads a CSS stylesheet from `url` and attaches to the element inside a Shadow Root, if present.
Otherwise, adds the stylesheet to `document.head` and shares it globally.

## loadScript(url)

Loads a JS file globally on document.head, as a tag.
The URL is loaded only once per page.

## onInit(fn) / onUpdate(fn) / onDestroy(fn)

Lifecycle hooks for callbacks that run when a component first runs, when any prop changes or when the component is destroyed (in case of custom elements)

## mount(target, component)

Mounts a component into a target element.

Target can be a string with a CSS selector, an HTML element or a [DocumentFragment](https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment).

`component` is a component definition object, with any of:

- a `template` string or element
- a `setup` function
- a `shadowDom` configuration.

## Other tools and helpers

## tpl(html: string)

At runtime, the `tpl` function can help with parsing an HTML text.

```ts
import { tpl, createComponent, defineProps } from "@li3/web";
const template = tpl`<div>Hello, {{name}}!</div>`;
```


## Plugins

Plugins can hook into any of the lifecycle stages and run side-effects or modify the component

```js
import { plugins } from "@li3/web";

plugins.use({
  setup(state) {
    // right after component state is created
  },
  createDom($el, domTree) {
    // when all elements are created, but not appended yet
  },
  createElement($el, domNode) {
    // for each node in the new dom tree (element or text node)
  },
  applyAttribute($el, element, attribute, value) {
    // when an attribute is being applied to an HTMLElement
  },
  appendDom({ element }) {
    // when the new dom tree is appended to the root element
  },
  init({ element }) {
    // when all bindings are ready
  },
  update($el, property, oldValue, newValue) {
    // a prop has changed
  },
  destroy({ element }) {
    // right before a node is detached from DOM and destroyed
    // only works with custom elements using `disconnectedCallback` hook
  },
});
```

